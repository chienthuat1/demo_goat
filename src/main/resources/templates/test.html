<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chi tiết Dê — Thuat's Goat Farm</title>
  <meta name="description" content="Chi tiết con dê: thông tin, lịch sử, cân nặng, tuổi, QR code và ảnh.">
  <style>
    :root{
      --bg: #0b1220; --card: #0f1a2b; --muted:#9fb0ff; --accent:#6cc36b; --glass: rgba(255,255,255,0.03);
      --radius:18px; --shadow: 0 18px 50px rgba(2,6,23,0.6);
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; color: #eaf3ee; background: linear-gradient(180deg,#051022 0%, #07182a 100%)}
    .wrap{max-width:1100px; margin:28px auto; padding:20px}

    header{display:flex; align-items:center; justify-content:space-between; gap:12px}
    header .brand{display:flex; gap:12px; align-items:center}
    .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,#4caf50,#6cc36b);display:flex;align-items:center;justify-content:center;font-weight:800;color:#041018}
    header h1{margin:0;font-size:18px}
    header p{margin:0;color:var(--muted);font-size:13px}

    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:var(--radius); border:1px solid rgba(255,255,255,0.04); box-shadow:var(--shadow); overflow:hidden}
    .grid{display:grid; grid-template-columns: 1fr 420px; gap:18px}
    @media (max-width:900px){ .grid{grid-template-columns:1fr} }

    .hero{position:relative; min-height:420px; overflow:hidden}
    .hero img{width:100%; height:100%; object-fit:cover; display:block}
    .overlay{position:absolute; left:18px; bottom:18px; background:linear-gradient(90deg, rgba(0,0,0,0.45), rgba(0,0,0,0.25)); padding:12px 14px; border-radius:12px}
    .overlay h2{margin:0;font-size:22px}
    .overlay em{color:var(--muted); font-style:italic}

    .content{padding:22px}
    .meta-row{display:flex; gap:8px; flex-wrap:wrap; margin:8px 0}
    .pill{background:var(--glass); padding:8px 12px; border-radius:999px; border:1px solid rgba(255,255,255,0.04); font-size:13px}

    .desc{color:#d7eadd; line-height:1.6}

    .info{display:grid; grid-template-columns:repeat(2, minmax(0,1fr)); gap:12px; margin-top:18px}
    .info div{background:rgba(255,255,255,0.02); padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,0.03)}
    .label{font-size:13px; color:var(--muted)}
    .value{font-weight:700}

    .status{display:inline-block; padding:6px 10px; border-radius:999px; font-weight:700}
    .status.live{background:linear-gradient(180deg, rgba(108,195,107,0.12), rgba(108,195,107,0.06)); color:var(--accent); border:1px solid rgba(108,195,107,0.12)}
    .status.off{background:linear-gradient(180deg, rgba(255,107,107,0.09), rgba(255,107,107,0.04)); color:#ff6b6b; border:1px solid rgba(255,107,107,0.08)}

    .gallery{display:flex; gap:10px; margin-top:14px}
    .gallery img{width:100%; height:100px; object-fit:cover; border-radius:10px}

    .actions{display:flex; gap:10px; margin-top:18px}
    .btn{padding:10px 14px; border-radius:12px; border:1px solid rgba(255,255,255,0.06); background:transparent; color:var(--muted); cursor:pointer}
    .btn.primary{background:linear-gradient(180deg,var(--accent), #57b35b); color:#041018; border:0; font-weight:700}

    .side{padding:18px}
    .side h3{margin:0 0 8px}
    .qr{display:block; width:100%; height:auto; border-radius:12px; background:#fff; padding:10px; text-align:center;color:#041018}

    .note{color:var(--muted); margin-top:12px; font-size:13px}
    .error{color:#ffb0b0; background:rgba(255,80,80,0.04); padding:12px; border-radius:8px; border:1px solid rgba(255,80,80,0.08)}

  </style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo">GF</div>
      <div>
        <h1>Chi tiết con Dê</h1>
        <p>Thông tin chi tiết của con dê trong trang trại — hiển thị động từ API</p>
      </div>
    </div>
    <div>
      <a href="/" style="color:var(--muted); text-decoration:none">← Về trang chính</a>
    </div>
  </header>

  <main style="margin-top:18px" class="card">
    <div style="padding:18px">
      <div class="grid">
        <div id="hero" class="hero" aria-hidden>
          <!-- ảnh chính sẽ chèn JS -->
        </div>

        <aside class="side">
          <h3>QR / Mã nhận dạng</h3>
          <div id="qrBox" class="qr">Đang tải...</div>
          <div class="note">Quét QR để xem thông tin trên thiết bị di động.</div>

          <div style="margin-top:16px">
            <h3>Hành động</h3>
            <div style="display:flex; gap:8px; margin-top:8px">
              <button id="btnFav" class="btn">Yêu thích</button>
              <button id="btnShare" class="btn primary">Chia sẻ</button>
            </div>
          </div>
        </aside>
      </div>

      <div class="content">
        <div id="metaRow" class="meta-row"></div>

        <p id="description" class="desc">Đang tải mô tả...</p>

        <div id="infoGrid" class="info"></div>

        <div class="gallery" id="gallery"></div>

        <div class="actions">
          <button class="btn" onclick="history.back()">← Quay lại</button>
        </div>

        <div id="errorBox" style="margin-top:12px"></div>
      </div>
    </div>
  </main>

  <footer style="text-align:center; margin-top:20px; color:var(--muted)">Thuat's Goat Farm — chi tiết con dê</footer>
</div>

<script>
  function getQueryParam(name) {
    const params = new URLSearchParams(location.search);
    return params.get(name);
  }

  async function loadDetail() {
    const idParam = getQueryParam('id');
    const hero = document.getElementById('hero');
    const metaRow = document.getElementById('metaRow');
    const description = document.getElementById('description');
    const infoGrid = document.getElementById('infoGrid');
    const gallery = document.getElementById('gallery');
    const qrBox = document.getElementById('qrBox');
    const errorBox = document.getElementById('errorBox');

    try {
      const res = await fetch('https://demo-goat-cpbn.onrender.com/goats/all');
      if(!res.ok) throw new Error('Không lấy được dữ liệu — HTTP ' + res.status);
      const goats = await res.json();

      let goat;
      if(idParam) {
        goat = goats.find(g => String(g.id_goat) === String(idParam));
      }
      if(!goat) goat = goats[0];
      if(!goat) throw new Error('Không có dữ liệu con dê.');

      // hero image
      hero.innerHTML = `<img src="${goat.img_url ? goat.img_url : 'https://images.unsplash.com/photo-1500534314209-a25ddb2bd429?q=80&w=800&auto=format&fit=crop'}" alt="Goat ${goat.id_goat}"><div class="overlay"><h2>Dê #${goat.id_goat} <small style="opacity:.9">(ID)</small></h2><div style="height:6px"></div><em>${goat.description}</em></div>`;

      // meta pills
      metaRow.innerHTML = '';
      const life = document.createElement('div'); life.className = 'pill'; life.textContent = `Ngày sinh: ${goat.birthday}`;
      const weight = document.createElement('div'); weight.className = 'pill'; weight.textContent = `Cân nặng: ${goat.weight}kg`;
      const gender = document.createElement('div'); gender.className = 'pill'; gender.textContent = `Giới tính: ${goat.gender ? 'Đực' : 'Cái'}`;
      metaRow.appendChild(life); metaRow.appendChild(weight); metaRow.appendChild(gender);

      // description
      description.textContent = goat.description;

      // info grid
      infoGrid.innerHTML = `
          <div><div class="label">Trạng thái</div><div class="value"><span class="status ${goat.status && goat.status.toLowerCase()==='live' ? 'live' : 'off'}">${goat.status}</span></div></div>
          <div><div class="label">QR Code</div><div class="value"><a href="${goat.qr_code}" target="_blank" style="color:var(--muted); text-decoration:underline">Mở QR</a></div></div>
        `;

      // gallery (show main + two placeholders)
      gallery.innerHTML = `
            <img src="${goat.img_url ? goat.img_url : 'https://images.unsplash.com/photo-1500534314209-a25ddb2bd429?q=80&w=800&auto=format&fit=crop'}" alt="Goat ${goat.id_goat}">
            <img src="${goat.img_url ? goat.img_url : 'https://images.unsplash.com/photo-1500534314209-a25ddb2bd429?q=80&w=800&auto=format&fit=crop'}" alt="Goat ${goat.id_goat}">
            <img src="${goat.img_url ? goat.img_url : 'https://images.unsplash.com/photo-1500534314209-a25ddb2bd429?q=80&w=800&auto=format&fit=crop'}" alt="Goat ${goat.id_goat}">
          `;

      // qr box show link + small image if possible
      qrBox.innerHTML = `<a href="${goat.qr_code}" target="_blank">Mã QR - mở liên kết</a>`;

      // interactions
      document.getElementById('btnFav').onclick = () => alert('Đã thêm Dê #' + goat.id_goat + ' vào yêu thích ❤️');
      document.getElementById('btnShare').onclick = async () => {
        if(navigator.share) {
          try { await navigator.share({title: 'Chi tiết Dê', text: goat.description, url: location.href}); } catch(e) {}
        } else {
          prompt('Copy link để chia sẻ', location.href);
        }
      };

    } catch (err) {
      console.error(err);
      errorBox.innerHTML = `<div class="error">Lỗi: ${err.message}</div>`;
    }
  }
  document.addEventListener('DOMContentLoaded', loadDetail);
</script>
</body>
</html>
